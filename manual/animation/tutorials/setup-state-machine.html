<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>HOWTO: Setup state machine | Flax Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="HOWTO: Setup state machine | Flax Documentation ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    <meta property="docfx:newtab" content="true">
    
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-88357703-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-88357703-2');
    </script>
  </head>	  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="https://www.flaxengine.com">
        		<div style="text-align:center; line-height:45px">
        	    <img id="logo" height="40" width="40" src="../../../logo.png" alt="">
        		</div>
        	  </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="howto-setup-state-machine">HOWTO: Setup state machine</h1>

<p>In this tutorial, you will learn how to create and use the State Machine inside the Anim Graph to switch between different animations based on input parameters.</p>
<h2 id="1-prepare-anim-graph-and-assets">1. Prepare Anim Graph and assets</h2>
<p><img src="media/empty-anim-graph.png" alt="Prepare Anim Graph"></p>
<p>Firstly you will need to prepare your animations and skinned model. Then create an Anim Graph that will be used to setup the state machine. You can follow <a href="create-anim-graph.html">this tutorial</a> to learn how to do it.</p>
<h2 id="2-add-state-machine-node">2. Add <strong>State Machine</strong> node</h2>
<p><img src="media/new-state-machine.png" alt="Add Anim Graph State Machine"></p>
<p><strong>Right-click</strong> over the surface and type <strong>State Machine</strong> and hit enter or select that node from the hierarchy to spawn it. Then you can specify its name. The default <em>Locomotion</em> name should fit most of the use cases so just hit <em>Enter</em>. Then connect it with the <em>Anim Graph</em> output node as shown in the picture below.</p>
<p><img src="media/link-state-machine.png" alt="Link State Machine"></p>
<div class="NOTE"><h5>Note</h5><p>You can rename state machine node by using <em>double-click</em> over the node header.</p>
</div>
<h2 id="3-open-state-machine-graph">3. Open State Machine graph</h2>
<p><img src="media/open-state-machine.png" alt="Open State Machine"></p>
<p>Next step is to open the state machine graph to modify it. Just press the <strong>Edit</strong> button located below the node title.
Each state machine contains a nested graph of states and transitions. You can see the navigation bar on window toolstrip that allows you to move back to the surface by pressing <em>Anim Graph/</em> button. During editing states and transitions this comes handly when moving around the graphs.</p>
<p>After opening the graph it contains a default <strong>Entry</strong> node which is used to point the default state of the state machine. The one that is assigned after state machine initialization (eg. Idle).</p>
<h2 id="4-add-states">4. Add states</h2>
<p><img src="media/add-state.png" alt="Add State"></p>
<p>Now, use <em>right-click</em> menu to add new states to your state machine. Each state can have own name. After adding states you can move them around by pressing and dragging them over the title. Cross button removes states and tool button allows renaming state after creation.</p>
<p><img src="media/example-state-machine-1.png" alt="Example State Machine States"></p>
<h2 id="5-create-transitions">5. Create transitions</h2>
<p><img src="media/example-state-machine-2.png" alt="Example State Machine States Connected"></p>
<p>By pressing left mouse button over the edge of the state or entry node and dragging the mouse you can create transitions. This works the same as connecting surface boxes. Connect your states and add the output from the entry node to prepare the state machine. We will adjust the transitions to implement a correct behavior for this state machine flow.</p>
<div class="NOTE"><h5>Note</h5><p>You can press <strong>middle mouse button</strong> to <strong>remove transitions</strong> or <em>right-click</em> to use a context menu. Just click over the transition line (it highlights).</p>
</div>
<h2 id="6-setup-state-animations">6. Setup state animations</h2>
<p><img src="media/anim-graph-state-edit.png" alt="Anim Graph State Output"></p>
<p>Every state can define custom animation pose sampling. This includes single animation playback or more advances use cases like multi blend using special nodes. To edit state simply <strong>double click</strong> on it. It will open the sub-graph that allows defining the animation output. It works similar to the master output node of the Anim Graph except it&#39;s only used when the state is in use.</p>
<p>In this example, we simply sample the <strong>Idle</strong> and <strong>Punch</strong> animations.</p>
<p><img src="media/sample-idle-state.png" alt="Sample Idle"></p>
<p>
</p>

<p><img src="media/sample-punch-state.png" alt="Sample Punch"></p>
<h2 id="7-add-parameters">7. Add parameters</h2>
<p>To control state machine logic flow you will need to define the transition rules. Each transition can be triggered under certain circumstances that you can define. For instance, when a player is falling then you can detect this fact in your script and pass the variable to the Anim Graph parameter that will trigger a transition to Falling state and play the proper animation of the player falling down. To learn how to create Anim Graph parameters see <a href="change-anim-graph-param.html">this tutorial</a>.</p>
<p>In this example, we use <strong>Is Punching</strong> parameter to toggle between <em>Idle</em> and <em>Punch</em> states.</p>
<p><img src="media/anim-param-for-states.png" alt="Anim Graph Parameter"></p>
<h2 id="8-setup-transition-rules">8. Setup transition rules</h2>
<p>The last step is to use the input parameter to define the state transition rules. To edit transition you can <strong>left-click</strong> over it. Then the properties panel will pop up.</p>
<p><img src="media/transition-properties-panel.png" alt="State Transition Properties"></p>
<p>Each transition has a set of various properties that you can define. Disabled transitions are gray-out in the editor to help you guide. You can also adjust the transition time and blending mode. Option <strong>Use Default Rule</strong> can be used to fire the automatic transition when the state animation is about to end. This is useful when creating single-shot states without manually creating a rule.</p>
<p>To edit state transition rule trigger logic use <strong>Edit Rule</strong> button or <strong>double-click</strong> on it (on connection line).
Then the transition graph will show. Again, it works like a State Machine graph. This sub-graph contains a single output node that samples the boolean value which determinates whenever trigger the transition.</p>
<p><img src="media/state-transition-definition-1.png" alt="State Transition Rule 1"></p>
<p>
</p>

<p><img src="media/state-transition-definition-2.png" alt="State Transition Rule 2"></p>
<p>In this example, we define two transitions: one from Idle to Punch, and other from Punch to Idle. Both are using the <em>Is Punching</em> variable but in an opposite way (as a toggle). You an use various comparision nodes and math nodes to define various types of transition rules.</p>
<p>Also, remember about using special <strong>Transition Source State Anim</strong> node that can be added to the transition graph to access the source state animation playback information. It can be used to trigger the animation in a specific moment, for instance when the source state animation is about to end.</p>
<p><img src="media/transition-source-state-anim.png" alt="Transition Source State Anim"></p>
<h2 id="9-test-it-out">9. Test it out!</h2>
<p>The final step is to test the state machine behavior in the live action. You can drive the parameters from code or try editing parameters values to see the preview.</p>
<p><img src="media/punching-state-example.gif" alt="State Machine Action"></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/honzapatCZ/FlaxDocs/blob/master/manual/animation/tutorials/setup-state-machine.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2012-2021 Wojciech Figat
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
